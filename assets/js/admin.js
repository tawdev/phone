// Admin JavaScript

document.addEventListener('DOMContentLoaded', function() {
    // Admin mobile menu toggle
    const adminMenuToggle = document.getElementById('adminMenuToggle');
    const adminSidebar = document.getElementById('adminSidebar');
    const adminSidebarOverlay = document.getElementById('adminSidebarOverlay');
    
    if (adminMenuToggle && adminSidebar) {
        // Prevent event bubbling and ensure click works
        adminMenuToggle.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            const isActive = adminSidebar.classList.contains('active');
            
            if (isActive) {
                adminSidebar.classList.remove('active');
                adminMenuToggle.classList.remove('active');
                if (adminSidebarOverlay) {
                    adminSidebarOverlay.classList.remove('active');
                }
            } else {
                adminSidebar.classList.add('active');
                adminMenuToggle.classList.add('active');
                if (adminSidebarOverlay) {
                    adminSidebarOverlay.classList.add('active');
                }
            }
        }, false);
        
        // Close menu when clicking on overlay
        if (adminSidebarOverlay) {
            adminSidebarOverlay.addEventListener('click', function() {
                adminSidebar.classList.remove('active');
                adminMenuToggle.classList.remove('active');
                adminSidebarOverlay.classList.remove('active');
            });
        }
        
        // Close menu when clicking on a sidebar link
        const sidebarLinks = adminSidebar.querySelectorAll('a');
        sidebarLinks.forEach(link => {
            link.addEventListener('click', function() {
                adminSidebar.classList.remove('active');
                adminMenuToggle.classList.remove('active');
                if (adminSidebarOverlay) {
                    adminSidebarOverlay.classList.remove('active');
                }
            });
        });
        
        // Close menu when clicking outside (on mobile)
        document.addEventListener('click', function(e) {
            if (window.innerWidth <= 768) {
                if (!adminSidebar.contains(e.target) && !adminMenuToggle.contains(e.target)) {
                    adminSidebar.classList.remove('active');
                    adminMenuToggle.classList.remove('active');
                    if (adminSidebarOverlay) {
                        adminSidebarOverlay.classList.remove('active');
                    }
                }
            }
        });
        
        // Handle window resize
        window.addEventListener('resize', function() {
            if (window.innerWidth > 768) {
                adminSidebar.classList.remove('active');
                adminMenuToggle.classList.remove('active');
                if (adminSidebarOverlay) {
                    adminSidebarOverlay.classList.remove('active');
                }
            }
        });
    }
    
    // Confirm delete actions
    const deleteLinks = document.querySelectorAll('a[href*="delete"]');
    deleteLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            if (!confirm('Êtes-vous sûr de vouloir supprimer cet élément ?')) {
                e.preventDefault();
            }
        });
    });
    
    // Auto-generate slug in admin forms
    const nameInput = document.getElementById('name');
    const slugInput = document.getElementById('slug');
    
    if (nameInput && slugInput) {
        nameInput.addEventListener('input', function() {
            if (!slugInput.value || slugInput.dataset.autoGenerated === 'true') {
                const slug = generateSlug(this.value);
                slugInput.value = slug;
                slugInput.dataset.autoGenerated = 'true';
            }
        });
        
        slugInput.addEventListener('input', function() {
            this.dataset.autoGenerated = 'false';
        });
    }
    
    // Image preview
    const imageInput = document.getElementById('image');
    if (imageInput) {
        imageInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    let preview = document.querySelector('.image-preview');
                    if (!preview) {
                        preview = document.createElement('div');
                        preview.className = 'image-preview';
                        imageInput.parentNode.appendChild(preview);
                    }
                    preview.innerHTML = `
                        <img src="${e.target.result}" alt="Preview" style="max-width: 200px; margin-top: 1rem; border-radius: 0.25rem;">
                    `;
                };
                reader.readAsDataURL(file);
            }
        });
    }
});

// Generate slug function
function generateSlug(str) {
    return str
        .toLowerCase()
        .trim()
        .replace(/[^\w\s-]/g, '')
        .replace(/[\s_-]+/g, '-')
        .replace(/^-+|-+$/g, '');
}

